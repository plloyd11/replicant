---
import { getImage } from 'astro:assets';

const heroImageFiles = import.meta.glob<{ default: ImageMetadata }>('../../assets/heros/*.jpg', {
    eager: true,
});

const heroAlts = [
    'Replicant performing live on stage',
    'Replicant guitarist shredding during a live set',
    'Replicant band member performing at a metal show',
    'Replicant on stage at a live concert',
    'Replicant playing an intense live performance',
    'Replicant death metal live on stage',
    'Replicant band performing at a live show',
];

const processedImages = await Promise.all(
    Object.values(heroImageFiles).map((hero) =>
        getImage({ src: hero.default, format: 'avif', quality: 90 }),
    ),
);

const heroData = processedImages.map((img, i) => ({
    src: img.src,
    alt: heroAlts[i] || 'Replicant live performance',
}));

const firstImage = processedImages[0];
---

<section id="intro" class="relative mt-12 bg-replicant-900">
    <h1 class="sr-only">Replicant - Technical Death Metal from New Jersey</h1>
    <div class="lg:relative lg:flex lg:items-center">
        <div class="flex relative flex-col mx-auto max-w-screen-2xl">
            <div
                class="flex order-2 justify-center items-center px-4 mt-4 w-full md:justify-between lg:mt-0 2xl:px-0 lg:order-1"
            >
                <p
                    class="font-semibold text-center uppercase md:text-left text-replicant-300 xl:text-xl"
                >
                    Respect New Jersey or prepare for combat
                </p>
                <p
                    class="hidden text-sm font-semibold uppercase md:block text-replicant-300 xl:text-xl"
                >
                    EST. MMXIV
                </p>
            </div>
            <div class="order-1 lg:order-2">
                <div id="hero-images" class="relative">
                    <img
                        id="hero-img"
                        src={heroData[0].src}
                        alt={heroData[0].alt}
                        width={firstImage.attributes.width}
                        height={firstImage.attributes.height}
                        fetchpriority="high"
                    />
                </div>
            </div>
        </div>
    </div>
</section>

<script define:vars={{ heroData }}>
    const img = document.getElementById('hero-img');
    if (img && heroData.length > 1) {
        const randomIndex = Math.floor(Math.random() * heroData.length);
        const chosen = heroData[randomIndex];
        img.src = chosen.src;
        img.alt = chosen.alt;
    }
</script>
